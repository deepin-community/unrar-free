#!/bin/sh
#
# Test CVE-2017-14122

setUp() {
	uudecode > unrar-gpl-stack-overread.rar <<EOF
begin-base64 644 -
UmFyIRoHADAwMDAwDQAwMDAwMDAwMHQwMDA=
====
EOF
}

tearDown() {
	rm -f unrar-gpl-stack-overread.rar
}

testList() {
	valgrind --error-exitcode=122 --track-origins=yes unrar-free --list unrar-gpl-stack-overread.rar
	assertEquals "Valgrind status code" 0 $?
}

testExtract() {
	valgrind --error-exitcode=122 --track-origins=yes unrar-free --extract unrar-gpl-stack-overread.rar
	assertNotEquals "Valgrind status code" 122 $?
}

. /usr/bin/shunit2
